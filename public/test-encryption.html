<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫ - disCard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin-bottom: 30px; padding: 20px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #0066FF; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #0066FF; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #0052CC; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .code { background: #f4f4f4; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; word-break: break-all; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd; }
        .stat-value { font-size: 2em; font-weight: bold; color: #0066FF; }
        .stat-label { color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫ disCard</h1>
        
        <div class="test-section">
            <h2>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h2>
            <div id="system-status"></div>
        </div>

        <div class="test-section">
            <h2>–¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="cards-count">0</div>
                    <div class="stat-label">–¢–µ—Å—Ç–æ–≤–∏—Ö –∫–∞—Ä—Ç–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="encryption-time">-</div>
                    <div class="stat-label">–ß–∞—Å —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (–º—Å)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="decryption-time">-</div>
                    <div class="stat-label">–ß–∞—Å –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (–º—Å)</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>–ë–∞–∑–æ–≤—ñ —Ç–µ—Å—Ç–∏</h2>
            <button onclick="testCryptoSupport()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É Web Crypto API</button>
            <button onclick="testKeyGeneration()">–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á—ñ–≤</button>
            <button onclick="testSingleCardEncryption()">–¢–µ—Å—Ç —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –æ–¥–Ω—ñ—î—ó –∫–∞—Ä—Ç–∫–∏</button>
            <button onclick="testMultipleCards()">–¢–µ—Å—Ç —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∫–∞—Ä—Ç–æ–∫</button>
            <div id="basic-tests-results"></div>
        </div>

        <div class="test-section">
            <h2>–¢–µ—Å—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó</h2>
            <button onclick="createTestCards()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏</button>
            <button onclick="testMigration()">–¢–µ—Å—Ç –º—ñ–≥—Ä–∞—Ü—ñ—ó —ñ—Å–Ω—É—é—á–∏—Ö –∫–∞—Ä—Ç–æ–∫</button>
            <button onclick="clearTestData()">–û—á–∏—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ</button>
            <div id="migration-tests-results"></div>
        </div>

        <div class="test-section">
            <h2>–°—Ç—Ä–µ—Å-—Ç–µ—Å—Ç–∏</h2>
            <button onclick="stressTestEncryption()">–°—Ç—Ä–µ—Å-—Ç–µ—Å—Ç (100 –∫–∞—Ä—Ç–æ–∫)</button>
            <button onclick="performanceTest()">–¢–µ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</button>
            <div id="stress-tests-results"></div>
        </div>

        <div class="test-section">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h2>
            <div id="all-results"></div>
        </div>
    </div>

    <!-- Include required scripts -->
    <script src="/js/CryptoManager.js?v=1"></script>
    <script src="/js/MigrationManager.js?v=1"></script>

    <script>
        let cryptoManager;
        let migrationManager;
        let testKey;
        let testResults = [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeTestEnvironment();
            updateSystemStatus();
        });

        async function initializeTestEnvironment() {
            try {
                cryptoManager = new CryptoManager();
                
                // Create a mock data manager for migration testing
                const mockDataManager = {
                    encryptionEnabled: true,
                    cryptoManager: cryptoManager,
                    encryptionKey: null
                };
                
                migrationManager = new MigrationManager(mockDataManager);
                
                // Generate test key
                testKey = await cryptoManager.generateTestKey();
                mockDataManager.encryptionKey = testKey;
                
                addResult('info', '–¢–µ—Å—Ç–æ–≤–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ' + error.message);
            }
        }

        function updateSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            let html = '<div class="info">üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–∏—Å—Ç–µ–º—É...</div>';
            
            // Check Web Crypto API support
            if (CryptoManager.isSupported()) {
                html += '<div class="success">‚úÖ Web Crypto API –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è</div>';
            } else {
                html += '<div class="error">‚ùå Web Crypto API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è</div>';
            }
            
            // Check crypto manager
            if (cryptoManager) {
                html += '<div class="success">‚úÖ CryptoManager —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ</div>';
            } else {
                html += '<div class="error">‚ùå CryptoManager –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ</div>';
            }
            
            // Check test key
            if (testKey) {
                html += '<div class="success">‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π –∫–ª—é—á –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ</div>';
            } else {
                html += '<div class="error">‚ùå –¢–µ—Å—Ç–æ–≤–∏–π –∫–ª—é—á –Ω–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ</div>';
            }
            
            statusDiv.innerHTML = html;
        }

        async function testCryptoSupport() {
            const supported = CryptoManager.isSupported();
            if (supported) {
                addResult('success', 'Web Crypto API –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è');
                
                // Test additional features
                try {
                    const testData = new TextEncoder().encode('test');
                    const key = await crypto.subtle.generateKey(
                        { name: 'AES-GCM', length: 256 },
                        false,
                        ['encrypt', 'decrypt']
                    );
                    
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    const encrypted = await crypto.subtle.encrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        testData
                    );
                    
                    addResult('success', '–ë–∞–∑–æ–≤–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è AES-GCM –ø—Ä–∞—Ü—é—î');
                } catch (error) {
                    addResult('error', '–ü–æ–º–∏–ª–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è: ' + error.message);
                }
            } else {
                addResult('error', 'Web Crypto API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ü–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
            }
        }

        async function testKeyGeneration() {
            try {
                const start = performance.now();
                const key1 = await cryptoManager.generateKey('test@example.com', 'password123');
                const key2 = await cryptoManager.generateKey('test@example.com', 'password123');
                const key3 = await cryptoManager.generateKey('test@example.com', 'password456');
                const end = performance.now();
                
                addResult('success', `–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–ª—é—á—ñ–≤ –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ –∑–∞ ${Math.round(end - start)}–º—Å`);
                addResult('info', '–û–¥–Ω–∞–∫–æ–≤—ñ –¥–∞–Ω—ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—ñ –∫–ª—é—á—ñ (–¥–µ—Ç–µ—Ä–º—ñ–Ω—ñ–∑–º)');
                addResult('info', '–†—ñ–∑–Ω—ñ –ø–∞—Ä–æ–ª—ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å —Ä—ñ–∑–Ω—ñ –∫–ª—é—á—ñ');
                
            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á–∞: ' + error.message);
            }
        }

        async function testSingleCardEncryption() {
            try {
                const testCard = {
                    id: 'test-1',
                    name: '–ê–¢–ë',
                    code: '1234567890123',
                    codeType: 'barcode',
                    createdAt: new Date().toISOString()
                };

                const encryptStart = performance.now();
                const encrypted = await cryptoManager.encryptCard({ code: testCard.code }, testKey);
                const encryptEnd = performance.now();
                
                document.getElementById('encryption-time').textContent = Math.round(encryptEnd - encryptStart);

                addResult('info', '–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞ –∫–∞—Ä—Ç–∫–∞: <div class="code">' + encrypted.substring(0, 100) + '...</div>');

                const decryptStart = performance.now();
                const decrypted = await cryptoManager.decryptCard(encrypted, testKey);
                const decryptEnd = performance.now();
                
                document.getElementById('decryption-time').textContent = Math.round(decryptEnd - decryptStart);

                if (decrypted.code === testCard.code) {
                    addResult('success', '–û–¥–Ω–∞ –∫–∞—Ä—Ç–∫–∞: —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/–¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ–π—à–ª–æ —É—Å–ø—ñ—à–Ω–æ');
                } else {
                    addResult('error', '–ü–æ–º–∏–ª–∫–∞: –∫–æ–¥ –∫–∞—Ä—Ç–∫–∏ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î –ø—ñ—Å–ª—è –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è');
                }

            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏: ' + error.message);
            }
        }

        async function testMultipleCards() {
            try {
                const testCards = [
                    { id: '1', name: '–ê–¢–ë', code: '1111111111111', codeType: 'barcode', createdAt: new Date().toISOString() },
                    { id: '2', name: '–°—ñ–ª—å–ø–æ', code: '2222222222222', codeType: 'barcode', createdAt: new Date().toISOString() },
                    { id: '3', name: 'EVA', code: 'QRCODE12345', codeType: 'qrcode', createdAt: new Date().toISOString() }
                ];

                document.getElementById('cards-count').textContent = testCards.length;

                const encryptStart = performance.now();
                const encrypted = await cryptoManager.encryptCards(testCards, testKey);
                const encryptEnd = performance.now();

                const decryptStart = performance.now();
                const decrypted = await cryptoManager.decryptCards(encrypted, testKey);
                const decryptEnd = performance.now();

                document.getElementById('encryption-time').textContent = Math.round(encryptEnd - encryptStart);
                document.getElementById('decryption-time').textContent = Math.round(decryptEnd - decryptStart);

                // Verify all cards
                let allMatch = true;
                for (let i = 0; i < testCards.length; i++) {
                    if (testCards[i].code !== decrypted[i].code) {
                        allMatch = false;
                        break;
                    }
                }

                if (allMatch) {
                    addResult('success', `–î–µ–∫—ñ–ª—å–∫–∞ –∫–∞—Ä—Ç–æ–∫ (${testCards.length}): —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/–¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ–π—à–ª–æ —É—Å–ø—ñ—à–Ω–æ`);
                } else {
                    addResult('error', '–ü–æ–º–∏–ª–∫–∞: –Ω–µ –≤—Å—ñ –∫–∞—Ä—Ç–∫–∏ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ');
                }

                // Check encrypted structure
                addResult('info', '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏: <div class="code">' + JSON.stringify(encrypted[0], null, 2) + '</div>');

            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∫–∞—Ä—Ç–æ–∫: ' + error.message);
            }
        }

        function createTestCards() {
            const testCards = [
                { id: '1', name: '–ê–¢–ë', code: '1111111111111', codeType: 'barcode', createdAt: new Date().toISOString() },
                { id: '2', name: '–°—ñ–ª—å–ø–æ', code: '2222222222222', codeType: 'barcode', createdAt: new Date().toISOString() },
                { id: '3', name: 'EVA', code: 'QRCODE12345', codeType: 'qrcode', createdAt: new Date().toISOString() }
            ];

            // Save unencrypted cards to localStorage for migration test
            localStorage.setItem('cards', JSON.stringify(testCards));
            localStorage.removeItem('encryptionMigrationCompleted');

            addResult('success', '–°—Ç–≤–æ—Ä–µ–Ω–æ 3 —Ç–µ—Å—Ç–æ–≤—ñ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∫–∞—Ä—Ç–∫–∏ –≤ localStorage');
        }

        async function testMigration() {
            try {
                // Reset migration status
                migrationManager.resetMigration();
                
                const status = migrationManager.getMigrationStatus();
                addResult('info', '–°—Ç–∞—Ç—É—Å –º—ñ–≥—Ä–∞—Ü—ñ—ó: ' + JSON.stringify(status));
                
                const unencryptedCount = migrationManager.getUnencryptedCardsCount();
                addResult('info', `–ó–Ω–∞–π–¥–µ–Ω–æ ${unencryptedCount} –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫`);
                
                if (unencryptedCount > 0) {
                    const result = await migrationManager.performMigration(false);
                    
                    if (result.success) {
                        addResult('success', `–ú—ñ–≥—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞: ${result.message}`);
                        
                        // Verify migration
                        const cardsData = localStorage.getItem('cards');
                        if (cardsData) {
                            const cards = JSON.parse(cardsData);
                            const encryptedCount = cards.filter(card => card.isEncrypted).length;
                            addResult('success', `–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ${encryptedCount} –∫–∞—Ä—Ç–æ–∫`);
                        }
                    } else {
                        addResult('error', '–ü–æ–º–∏–ª–∫–∞ –º—ñ–≥—Ä–∞—Ü—ñ—ó: ' + result.error);
                    }
                } else {
                    addResult('info', '–ù–µ–º–∞—î –∫–∞—Ä—Ç–æ–∫ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó');
                }
                
            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É –º—ñ–≥—Ä–∞—Ü—ñ—ó: ' + error.message);
            }
        }

        async function stressTestEncryption() {
            try {
                const cardCount = 100;
                const testCards = [];
                
                // Generate test cards
                for (let i = 0; i < cardCount; i++) {
                    testCards.push({
                        id: `stress-${i}`,
                        name: `Test Card ${i}`,
                        code: `${Math.random().toString(36).substring(2, 15)}${Math.random().toString(36).substring(2, 15)}`,
                        codeType: i % 2 === 0 ? 'barcode' : 'qrcode',
                        createdAt: new Date().toISOString()
                    });
                }

                addResult('info', `–°—Ç–≤–æ—Ä–µ–Ω–æ ${cardCount} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–∞—Ä—Ç–æ–∫ –¥–ª—è —Å—Ç—Ä–µ—Å-—Ç–µ—Å—Ç—É`);

                const encryptStart = performance.now();
                const encrypted = await cryptoManager.encryptCards(testCards, testKey);
                const encryptEnd = performance.now();

                const decryptStart = performance.now();
                const decrypted = await cryptoManager.decryptCards(encrypted, testKey);
                const decryptEnd = performance.now();

                const encryptTime = Math.round(encryptEnd - encryptStart);
                const decryptTime = Math.round(decryptEnd - decryptStart);

                // Verify all cards
                let allMatch = true;
                for (let i = 0; i < testCards.length; i++) {
                    if (testCards[i].code !== decrypted[i].code) {
                        allMatch = false;
                        break;
                    }
                }

                if (allMatch) {
                    addResult('success', `–°—Ç—Ä–µ—Å-—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ: ${cardCount} –∫–∞—Ä—Ç–æ–∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –∑–∞ ${encryptTime}–º—Å, —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –∑–∞ ${decryptTime}–º—Å`);
                    addResult('info', `–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å: ${Math.round(cardCount * 1000 / encryptTime)} –∫–∞—Ä—Ç–æ–∫/—Å–µ–∫ (—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è), ${Math.round(cardCount * 1000 / decryptTime)} –∫–∞—Ä—Ç–æ–∫/—Å–µ–∫ (–¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è)`);
                } else {
                    addResult('error', '–°—Ç—Ä–µ—Å-—Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ: –ø–æ–º–∏–ª–∫–∞ –≤ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—ñ');
                }

                document.getElementById('cards-count').textContent = cardCount;
                document.getElementById('encryption-time').textContent = encryptTime;
                document.getElementById('decryption-time').textContent = decryptTime;

            } catch (error) {
                addResult('error', '–ü–æ–º–∏–ª–∫–∞ —Å—Ç—Ä–µ—Å-—Ç–µ—Å—Ç—É: ' + error.message);
            }
        }

        async function performanceTest() {
            const tests = [
                { count: 1, name: '1 –∫–∞—Ä—Ç–∫–∞' },
                { count: 5, name: '5 –∫–∞—Ä—Ç–æ–∫' },
                { count: 10, name: '10 –∫–∞—Ä—Ç–æ–∫' },
                { count: 50, name: '50 –∫–∞—Ä—Ç–æ–∫' },
                { count: 100, name: '100 –∫–∞—Ä—Ç–æ–∫' }
            ];

            addResult('info', '–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ...');

            for (const test of tests) {
                try {
                    const testCards = [];
                    for (let i = 0; i < test.count; i++) {
                        testCards.push({
                            id: `perf-${i}`,
                            name: `Card ${i}`,
                            code: `${Math.random().toString(36).substring(2, 15)}`,
                            codeType: 'barcode',
                            createdAt: new Date().toISOString()
                        });
                    }

                    const encryptStart = performance.now();
                    const encrypted = await cryptoManager.encryptCards(testCards, testKey);
                    const encryptEnd = performance.now();

                    const decryptStart = performance.now();
                    const decrypted = await cryptoManager.decryptCards(encrypted, testKey);
                    const decryptEnd = performance.now();

                    const encryptTime = Math.round(encryptEnd - encryptStart);
                    const decryptTime = Math.round(decryptEnd - decryptStart);

                    addResult('info', `${test.name}: —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è ${encryptTime}–º—Å, –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è ${decryptTime}–º—Å`);

                } catch (error) {
                    addResult('error', `–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É ${test.name}: ${error.message}`);
                }
            }

            addResult('success', '–¢–µ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }

        function clearTestData() {
            localStorage.removeItem('cards');
            localStorage.removeItem('encryptionMigrationCompleted');
            testResults = [];
            document.getElementById('all-results').innerHTML = '';
            addResult('info', '–¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
            updateStats();
        }

        function addResult(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const result = { type, message, timestamp };
            testResults.push(result);
            
            const resultsDiv = document.getElementById('all-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${type}`;
            resultElement.innerHTML = `[${timestamp}] ${message}`;
            resultsDiv.appendChild(resultElement);
            
            // Auto-scroll to bottom
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            updateStats();
        }

        function updateStats() {
            const successCount = testResults.filter(r => r.type === 'success').length;
            const errorCount = testResults.filter(r => r.type === 'error').length;
            
            // Update some basic stats if needed
        }
    </script>
</body>
</html>